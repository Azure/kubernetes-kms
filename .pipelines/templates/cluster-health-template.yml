steps:
  - script: |
      kubectl wait --for=condition=ready node --all
      kubectl wait pod -n kube-system --for=condition=Ready --all
      kubectl get nodes -owide
      kubectl cluster-info
    displayName: "Check cluster's health"
    
  - script: |
      docker exec kms-control-plane bash -c "cat /etc/kubernetes/manifests/kubernetes-kms.yaml"
      docker exec kms-control-plane bash -c "cat /etc/kubernetes/manifests/kube-apiserver.yaml"
      docker exec kms-control-plane bash -c "cat /etc/kubernetes/encryption-config.yaml"
      docker exec kms-control-plane bash -c "journalctl -u kubelet > kubelet.log && cat kubelet.log"
      docker exec kms-control-plane bash -c "cd /var/log/containers ; cat *"
      docker network ls
    displayName: "Debug logs"
    condition: failed()